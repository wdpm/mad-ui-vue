<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>circular motion</title>
    <style>
        body {
            /* set background color can remove canvas trails effect finally*/
            /* no matter what color you set*/
            background-color: black;
        }

        .canvas-wrapper {
            border: 1px solid black;
        }
    </style>
</head>
<body>
<div class="canvas-wrapper">
    <canvas id="canvas"></canvas>
</div>
<script>
    /**
     * Star trails
     * Created by evan on 2020/7/14
     */

    // todo option 1 isFollowMouse? true or false

    const canvas = document.querySelector('#canvas')
    const c = canvas.getContext('2d')
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight

    // canvas background

    const mouse = {
        x: canvas.width / 2,
        y: canvas.height / 2
    }

    // Event Listeners
    addEventListener('mousemove', event => {
        mouse.x = event.clientX
        mouse.y = event.clientY
    })

    addEventListener('resize', () => {
        canvas.width = innerWidth
        canvas.height = innerHeight

        // reset
        reset(c, canvas)
    })

    function randomIntFromRange(begin, end) {
        return Math.random() * (end - begin) + begin; //[0,end-begin) + begin => [begin,end)
    }

    // Objects
    function Circle(x, y, radius, color) {
        this.x = x
        this.y = y
        this.radius = radius // this radius is circle's radius
        this.color = color
        this.radian = Math.random() * (Math.PI * 2) // 2 pi = one circle
        this.velocity = 0.05
        this.distanceFromCenter = randomIntFromRange(50, 300) // this radius is for circle motion path
        this.lastMouse = {x: x, y: y}
        this.dragDelayFactor = 0.05 // value range (0,1]. 1 means no drag delay, tends to 0 mean big drag delay

        this.update = (ctx) => {
            const lastPosition = {x: this.x, y: this.y}

            // drag effect
            // (mouse.x - this.lastMouse.x) *0.05 , 0.05 means when mouse moves 100px, visual effect is moving 5px
            this.lastMouse.x += (mouse.x - this.lastMouse.x) * this.dragDelayFactor;
            this.lastMouse.y += (mouse.y - this.lastMouse.y) * this.dragDelayFactor;

            // update parameters
            this.radian += this.velocity
            this.x = this.lastMouse.x + Math.cos(this.radian) * this.distanceFromCenter;
            this.y = this.lastMouse.y + Math.sin(this.radian) * this.distanceFromCenter;

            // redraw
            this.draw(ctx, lastPosition)
        }

        this.draw = (ctx, lastPosition) => {
            ctx.beginPath()
            ctx.strokeStyle = this.color
            ctx.lineWidth = this.radius
            ctx.moveTo(lastPosition.x, lastPosition.y)
            ctx.lineTo(this.x, this.y)
            ctx.stroke()
            ctx.closePath()
        }
    }

    // circles
    let circles = []

    // colors
    let colors = [
        'red', 'green', 'blue'
    ]

    function randomColor(colors) {
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function init() {
        for (let i = 0; i < 30; i++) {
            const x = canvas.width / 2
            const y = canvas.height / 2
            const radius = (Math.random() * 2) +1;//[1,3)
            const color = randomColor(colors)
            circles.push(new Circle(x, y, radius, color))
        }
    }

    function reset(ctx, canvas) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Animation Loop
    function animate() {
        requestAnimationFrame(animate) // Create an animation loop

        // create a transparent layer on top of all layers to make visual fadeOut effect
        c.fillStyle = 'rgba(255, 255, 255, 0.05)'
        c.fillRect(0, 0, canvas.width, canvas.height) // Erase whole canvas

        circles.forEach(circle => {
            circle.update(c)
        })
    }

    init()
    animate()
</script>
</body>
</html>